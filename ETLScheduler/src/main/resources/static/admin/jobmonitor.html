<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JOB调度监控管理</title>
<link rel="stylesheet" href="/static/layui/css/layui.css"></link>
<link rel="stylesheet" href="/static/css/global.css"></link>
</head>
<body>

<script type="text/html" id="resultTpl">
{{#  if(d.errors == 0){ }}
    <span class="layui-badge layui-bg-green">成功</span>
{{# } }}

{{#  if(d.errors == 1){ }}
    <span class="layui-badge">失败</span>
{{# } }}

{{#  if(d.errors == 2){ }}
    <span class="layui-badge layui-bg-orange">执行中</span>
{{# } }}


</script>
<script type="text/html" id="statusTpl">
{{#  if(d.status == 'Done'){ }}
    <span class="layui-badge layui-bg-green">{{d.status}}</span>
  {{#  } else { }}
  <span class="layui-badge layui-bg-orange">{{d.status}}</span>
  {{#  } }}
</script>
<div class="weadmin-nav">
	<span class="layui-breadcrumb">
        <a href="">首页</a>
        <a><cite>调度监控</cite></a>
    </span>
			<a class="layui-btn layui-btn-sm" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
				<i class="layui-icon" style="line-height:30px">&#x1002;</i></a>
</div>

<div class="weadmin-body">
	<div class="layui-row"> 
		 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<div class="layui-inline">
			<label class="layui-form-label">作业名称：</label>
			<div class="layui-input-inline">
				<input type="text" id="job_name" name="jobName" placeholder="请输入关键字" autocomplete="off" class="layui-input"  onkeydown="if(event.keyCode==13) search()" >
			</div>
		</div>
		&nbsp;&nbsp;
         <div class="layui-inline">
           <button class="layui-btn layuiadmin-btn-list layui-btn-sm" id="job_search_btn" lay-submit=""  lay-filter="LAY-app-contlist-search">
             <i class="layui-icon layui-icon-search layuiadmin-button-btn" ></i>
           </button>
         </div>
         &nbsp;&nbsp;
          <div>
		    <table width="100%" id="jobMonitorListTable" ></table>
	     </div>
	</div>
</div>





<script src="/static/layui/layui.js"></script>
<!-- <script src="/static/js/jquery.js"></script> -->
<script type="text/javascript">
layui.use(['element','form','table','layer','jquery'], function(){
	  var element = layui.element;
	  	  from = layui.form;
	  	  table = layui.table;
	  	  layer = layui.layer;
	  	  $=layui.jquery;
	  
	  table.render({
		    elem: '#jobMonitorListTable'
		    	,size:'sm'
		    ,url:'/jobMonitor/listAll'
		    ,cols: [[
			  {type:'checkbox'}
		     /*  ,{field:'id', title: '序号',width:60,hide:'true'} */
		      ,{field:'jobName',width:180,align:'left', title: '作业名称'}
		      ,{field:'status',width:170, title: '状态',templet:statusTpl}
		      ,{field:'prviousDate',width:170,align:'left', title: '执行时间',templet: '<div>{{ layui.laytpl.toDateString(d.prviousDate) }}</div>'}
		      ,{field:'nextDate',width:170,align:'left', title: '下次执行时间',templet: '<div>{{ layui.laytpl.toDateString(d.nextDate) }}</div>'}
		      
		      ,{field:'errors',width:170, title: '执行结果',align:'center',templet:resultTpl}
		     
		    ]]
		    ,page: true
		  });
	  
	  //查询
	  $(document).on('click','#job_search_btn',function(){
		  var jobName=$("#job_name").val();
			table.reload("jobMonitorListTable",{
				page:{
					curr:1
				}
				,where:{
					jobName:jobName
				}
			});
		 });
		 
	//时间戳的处理
	  layui.laytpl.toDateString = function(d, format){
		if(d == null){
			return null
		}
	    var date = new Date(d || new Date())
	    ,ymd = [
	      this.digit(date.getFullYear(), 4)
	      ,this.digit(date.getMonth() + 1)
	      ,this.digit(date.getDate())
	    ]
	    ,hms = [
	      this.digit(date.getHours())
	      ,this.digit(date.getMinutes())
	      ,this.digit(date.getSeconds())
	    ];

	    format = format || 'yyyy-MM-dd HH:mm:ss';

	    return format.replace(/yyyy/g, ymd[0])
	    .replace(/MM/g, ymd[1])
	    .replace(/dd/g, ymd[2])
	    .replace(/HH/g, hms[0])
	    .replace(/mm/g, hms[1])
	    .replace(/ss/g, hms[2]);
	  };
	   
	  //数字前置补零
	  layui.laytpl.digit = function(num, length, end){
	    var str = '';
	    num = String(num);
	    length = length || 2;
	    for(var i = num.length; i < length; i++){
	      str += '0';
	    }
	    return num < Math.pow(10, length) ? str + (num|0) : num;
	  };

});

</script> 
</body>
</html>
